# Emergency Response 系統總覽

> **⚠️ 重要設計原則**  
> Emergency Response 副系統的設計**不受主系統 Command Center 深色主題約束**，採用獨立的 Light Theme（淺藍 + 金色）設計，強調清晰易讀與緊急情境下的視覺辨識度。

## 產品定位- 系統概要

**文件編號**：01  
**版本**：1.0  
**日期**：2026-01-04

---

## 1. 產品定位

**Emergency Response（任務指揮副系統）** 是 Light Keepers 災防平台的即時應變模組，專為災害發生時的現場指揮調度設計。

### 核心價值
- **任務導向**：一次災害、一個 Session，結束即可重置
- **即時同步**：WebSocket 推播 + 降級 Polling
- **離線可用**：PWA 快取關鍵資料與 SOP
- **資料隔離**：任務資料與主資料分層，重置不影響主系統

---

## 2. 系統架構

```
┌─────────────────────────────────────────────────────────────┐
│                    Light Keepers 主系統                      │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐            │
│  │ 志工管理    │ │ 物資管理    │ │ 知識庫/手冊  │            │
│  │ (Reference) │ │ (Reference) │ │ (Reference) │            │
│  └──────┬──────┘ └──────┬──────┘ └──────┬──────┘            │
│         │               │               │                   │
│  ═══════╪═══════════════╪═══════════════╪═══════════════    │
│         ▼               ▼               ▼                   │
│  ┌─────────────────────────────────────────────────────┐    │
│  │           Emergency Response 副系統                  │    │
│  │  ┌───────────────────────────────────────────────┐  │    │
│  │  │              Mission Session                  │  │    │
│  │  │  ┌─────────┐ ┌─────────┐ ┌─────────┐         │  │    │
│  │  │  │ Events  │ │ Tasks   │ │ Reports │         │  │    │
│  │  │  └─────────┘ └─────────┘ └─────────┘         │  │    │
│  │  │  ┌─────────┐ ┌─────────┐ ┌─────────┐         │  │    │
│  │  │  │ Alerts  │ │Inventory│ │ MapData │         │  │    │
│  │  │  │ (NCDR)  │ │   Txn   │ │(Session)│         │  │    │
│  │  │  └─────────┘ └─────────┘ └─────────┘         │  │    │
│  │  └───────────────────────────────────────────────┘  │    │
│  └─────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────┘
```

---

## 3. 資料分層

| 類型 | 說明 | 生命週期 | 範例 |
|------|------|----------|------|
| **Reference Data** | 主系統長期資料 | 永久 | 志工、物資基礎、SOP 模板 |
| **Session Data** | 任務期間資料 | 任務結束可清除 | 事件、通報、派工、異動 |

---

## 4. Mission Session 狀態機

```
Draft ──▶ Active ──▶ Closing ──▶ Archived ──▶ Purged
  │         │           │            │
  │         │           │            └── 資料已刪除
  │         │           └── 報表已匯出，待歸檔
  │         └── 任務進行中
  └── 準備中，可編輯設定
```

---

## 5. 角色權限

| 角色 | 啟用任務 | 操作 Dashboard | 結束任務 | 重置 | 匯出報表 |
|------|:--------:|:--------------:|:--------:|:----:|:--------:|
| Admin | ✓ | ✓ | ✓ | ✓ | ✓ |
| Commander | ✓ | ✓ | ✓ | ✗ | ✓ |
| Operator | ✗ | ✓ | ✗ | ✗ | ✗ |
| Viewer | ✗ | 唯讀 | ✗ | ✗ | ✗ |

---

## 6. 技術堆疊（固定）

| 層級 | 技術 |
|------|------|
| 前端 | React 19 + TypeScript + Vite + Bootstrap 5 |
| 狀態 | @tanstack/react-query + socket.io-client |
| 後端 | NestJS 10 + TypeORM + PostgreSQL 15 + PostGIS |
| 即時 | @nestjs/websockets + socket.io |
| 離線 | vite-plugin-pwa |

---

## 7. 專案路徑

| 服務 | 路徑 |
|------|------|
| GitHub | `https://github.com/xiangteng007/Emergency-Response` |
| GCP | `emergency-response-483312` |
| Firebase | `emergency-response-911` |
