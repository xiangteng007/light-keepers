# 實施路線圖 (Roadmap)

> **產出日期**: 2026-01-13  
> **規劃週期**: 12 週 (3 個月)  
> **團隊假設**: 2 名全職開發者 + 1 名測試/DevOps

---

## 🎯 階段概覽

| 階段 | 週次 | 主題 | 交付物 | 驗收條件 |
|:----:|:----:|------|--------|----------|
| **Phase 1** | W1-W4 | 核心閉環 (P0) | 示警→派遣→回報 | E2E 流程可運行 |
| **Phase 2** | W5-W8 | 進階功能 (P1) | 智慧派遣、AAR | ICS 完整度 80% |
| **Phase 3** | W9-W12 | 優化與治理 (P2) | 安全強化、優化 | 生產就緒 |

---

## 📅 Phase 1: 核心閉環 (Week 1-4)

### Week 1: 基礎串接

**主題**: 補齊關鍵缺口，建立端到端流程

#### 交付功能

| # | 功能 | 工時 | 負責人 |
|:-:|------|:----:|:------:|
| 1 | 案件去重邏輯 (C-M1) | 8h | Dev1 |
| 2 | 志工召集條件篩選 (B-M1) | 10h | Dev1 |
| 3 | 任務通知事件 (D-M1) | 4h | Dev2 |
| 4 | Controller Guard 全面檢查 (F-M1) | 8h | Dev2 |
| 5 | SITREP 自動產出 (A-M1) | 12h | Dev1 |

**測試**:

- [ ] 相同地點 100m 內重複通報被識別
- [ ] 志工召集 API 可依技能/距離篩選
- [ ] 任務指派後志工收到 LINE/Push 通知
- [ ] 所有 Controller 都有權限 Guard

**文件**:

- API 文件更新 (Swagger)
- 去重邏輯說明 (技術文件)

**驗收條件**:

```gherkin
Given 一個新的災情通報
When 30 分鐘內同地點有相似通報
Then 系統提示可能重複並關聯案件

Given 任務需要「急救」技能志工
When 管理員觸發召集
Then 僅有急救認證且距離 10km 內的志工收到通知
```

---

### Week 2: ICS 基礎建立

**主題**: 實作指揮體系核心邏輯

#### 交付功能

| # | 功能 | 工時 | 負責人 |
|:-:|------|:----:|:------:|
| 1 | IAP 簽核流程 (A-M2) | 10h | Dev1 |
| 2 | 指揮鏈建模 (A-M3) | 8h | Dev1 |
| 3 | 簽到/簽退機制 (D-M2) | 8h | Dev2 |
| 4 | 通知送達追蹤 (B-M2) | 8h | Dev2 |
| 5 | 案件 SLA 監控 (C-M2) | 6h | Dev2 |

**測試**:

- [ ] IAP 可送簽、核准、駁回、發布
- [ ] MissionSession 可指派 IC / Section Chiefs
- [ ] 志工簽到時驗證 GPS 在範圍內
- [ ] 可追蹤 LINE 訊息送達狀態

**文件**:

- ICS 操作手冊 (使用者)
- 指揮鏈設定指南

**驗收條件**:

```gherkin
Given 一個 Mission Session
When 管理員指派 Operations Chief
Then 該志工在 CommandChain 可見且有相應權限

Given 志工到達任務地點
When 志工點擊簽到並送出 GPS
Then 系統驗證位置並記錄簽到時間
```

---

### Week 3: 資料關聯與治理

**主題**: 建立資料追蹤與安全基線

#### 交付功能

| # | 功能 | 工時 | 負責人 |
|:-:|------|:----:|:------:|
| 1 | 案件雙向關聯追蹤 (C-M3) | 4h | Dev1 |
| 2 | 事件分級自動化 (A-M4) | 6h | Dev1 |
| 3 | 照片證據鏈 (F-M3) | 6h | Dev2 |
| 4 | 刪除策略統一 (F-M4) | 8h | Dev2 |
| 5 | 敏感資料遮罩 (F-M2) | 10h | Dev2 |

**測試**:

- [ ] 從 Report 可查詢關聯的 Tasks/Resources
- [ ] 新事件根據報案數/災害類型自動分級
- [ ] 照片上傳時計算 SHA-256 並存入 DB
- [ ] Report/Event/Task 刪除改為軟刪 (deletedAt)
- [ ] Level < 3 使用者看到的電話/地址被遮罩

**文件**:

- 資料分級與存取政策
- 刪除/復原操作指南

**驗收條件**:

```gherkin
Given 一筆已刪除的 Report
When Admin 執行 restore API
Then Report 的 deletedAt 被清除且重新可見

Given 志工查詢其他志工資料
When roleLevel = 1
Then 電話顯示為 "09** *** ***"
```

---

### Week 4: 智慧派遣啟動

**主題**: 實作 AI 輔助派遣

#### 交付功能

| # | 功能 | 工時 | 負責人 |
|:-:|------|:----:|:------:|
| 1 | 智慧派遣策略 (D-M3) 第一階段 | 12h | Dev1 |
| 2 | 態勢儀表板即時更新 (A-M5) | 8h | Dev2 |
| 3 | 地圖派遣整合 (D-M4) | 10h | Dev1+Dev2 |

**測試**:

- [ ] 智慧派遣 API 回傳志工列表 + 評分
- [ ] CommandCenterPage 使用 WebSocket 接收事件更新
- [ ] EmergencyResponsePage 地圖可點擊志工標記進行派遣

**文件**:

- 智慧派遣算法說明
- WebSocket 訂閱指南

**驗收條件**:

```gherkin
Given 一個新任務需要「醫療」技能
When 管理員請求智慧派遣建議
Then 系統回傳符合條件的志工列表，按距離+負載評分排序

Given 指揮官在 CommandCenterPage
When 新的災情通報建立
Then 頁面自動顯示新通報（無需手動重整）
```

**🎯 Phase 1 里程碑 (Week 4 End)**:

- ✅ 示警 → 動員 → 回報 → 派遣流程可完整運行
- ✅ ICS 基礎架構建立 (Session + CommandChain + IAP)
- ✅ 安全基線達標 (Guard + 遮罩 + 證據鏈)
- ✅ E2E 測試通過

---

## 📅 Phase 2: 進階功能 (Week 5-8)

### Week 5: AAR 與報表

**主題**: 建立復盤與報表輸出能力

#### 交付功能

| # | 功能 | 工時 | 負責人 |
|:-:|------|:----:|:------:|
| 1 | AAR 自動關聯資料 (G-M1) | 10h | Dev1 |
| 2 | 時間線視覺化串接 (G-M2) | 8h | Dev2 |
| 3 | 報表匯出整合 (G-M3) | 6h | Dev2 |

**測試**:

- [ ] 事件結案後可自動產生 AAR 草稿
- [ ] AAR 包含任務統計、資源使用、志工出勤
- [ ] EmergencyResponsePage 顯示時間線
- [ ] AAR 可匯出 PDF/Excel

**驗收條件**:

```gherkin
Given 一個已結案的事件
When 管理員產生 AAR
Then AAR 包含自動填充的任務完成率、資源消耗、時間線

Given AAR 已產生
When 管理員點擊匯出 PDF
Then 系統產生含圖表的 PDF 文件
```

---

### Week 6: 穩定性與優化

**主題**: 處理技術債與效能優化

#### 交付功能

| # | 功能 | 工時 | 負責人 |
|:-:|------|:----:|:------:|
| 1 | Resources 模組簡化 (E-M1) | 12h | Dev1 |
| 2 | 失聯警報機制 (D-S1) | 6h | Dev2 |
| 3 | 集合點管理專用邏輯 (B-S1) | 6h | Dev2 |

**測試**:

- [ ] Resources entities 減少至 < 25 個
- [ ] 志工 GPS 斷線 > 10 分鐘觸發警報
- [ ] 集合點可設定並通知志工

---

### Week 7: COP 整合

**主題**: 建立統一態勢圖

#### 交付功能

| # | 功能 | 工時 | 負責人 |
|:-:|------|:----:|:------:|
| 1 | COP 整合 (A-S1) | 12h | Dev1+Dev2 |
| 2 | 路徑規劃整合 (D-S2) | 8h | Dev1 |

**測試**:

- [ ] CommandCenterPage 整合地圖、報表、任務看板
- [ ] 任務派遣可顯示建議路徑

---

### Week 8: 進階通知與預測

**主題**: AI 功能擴充

#### 交付功能

| # | 功能 | 工時 | 負責人 |
|:-:|------|:----:|:------:|
| 1 | 資源需求預測 (E-S1) | 12h | Dev1 |
| 2 | 禁制區/熱區警報 (D-S3) | 6h | Dev2 |
| 3 | 批次通知模板管理 (B-S2) | 4h | Dev2 |

**🎯 Phase 2 里程碑 (Week 8 End)**:

- ✅ AAR 復盤系統完整
- ✅ ICS 完整度 80%
- ✅ 智慧派遣與預測功能上線
- ✅ 性能與穩定性優化完成

---

## 📅 Phase 3: 優化與治理 (Week 9-12)

### Week 9-10: 安全強化

**主題**: 達成生產就緒安全標準

#### 交付功能

| # | 功能 | 工時 | 負責人 |
|:-:|------|:----:|:------:|
| 1 | CORS/CSP 強化 (F-S1) | 4h | DevOps |
| 2 | Rate Limiting 細化 (F-S2) | 4h | DevOps |
| 3 | EXIF 資料自動提取 (C-S1) | 6h | Dev2 |
| 4 | SMS/Email 實際整合 (B-S3) | 8h | Dev1 |
| 5 | 多事件並行管理 (A-S2) | 8h | Dev1 |

**測試**:

- [ ] 生產環境 CORS 僅允許特定 domain
- [ ] 重要 API 有獨立 rate limit
- [ ] 照片上傳自動提取 GPS/時間戳
- [ ] Twilio/SendGrid 實際發送成功

---

### Week 11: 歷史與比較

**主題**: 建立長期分析能力

#### 交付功能

| # | 功能 | 工時 | 負責人 |
|:-:|------|:----:|:------:|
| 1 | 歷史事件快速複製 (A-S3) | 6h | Dev1 |
| 2 | 成效指標儀表板 (G-S1) | 8h | Dev2 |
| 3 | 歷史事件比較分析 (G-S2) | 10h | Dev1 |

**測試**:

- [ ] 可從歷史事件複製 IAP/SITREP 模板
- [ ] AnalyticsPage 顯示跨事件指標
- [ ] 可比較兩個事件的資源使用/任務完成率

---

### Week 12: 上線準備與驗收

**主題**: 全系統驗證與文件完善

#### 交付物

| # | 項目 | 負責人 |
|:-:|------|:------:|
| 1 | E2E 測試套件完整執行 | QA |
| 2 | 使用者手冊 (中文) | PM |
| 3 | 運維手冊 (部署/監控/備份) | DevOps |
| 4 | 安全稽核報告 | Security |
| 5 | 效能測試報告 (壓測) | DevOps |

**驗收清單**:

- [ ] 示警→動員→回報→派遣→任務→資源→結案→復盤 全流程可運行
- [ ] IAP/SITREP 可自動產出並簽核
- [ ] 案件去重、SLA 監控、簽到/簽退正常運作
- [ ] 智慧派遣與資源預測準確率 > 70%
- [ ] 所有 API 有權限 Guard
- [ ] 敏感資料遮罩正常
- [ ] 照片證據鏈可驗證
- [ ] AAR 可自動關聯並匯出
- [ ] WebSocket 即時推送正常
- [ ] 生產環境 CORS/CSP/Rate Limit 正確
- [ ] 文件齊全（API/使用者/運維）

**🎯 Phase 3 里程碑 (Week 12 End)**:

- ✅ 生產環境部署且穩定運行
- ✅ 所有 Must Have + 80% Should Have 完成
- ✅ 安全與效能達標
- ✅ 文件完善，可交付使用

---

## 📊 工時總結

| 階段 | 開發工時 | QA/DevOps | 文件 | 總計 |
|------|:--------:|:---------:|:----:|:----:|
| Phase 1 | 152h | 20h | 8h | 180h |
| Phase 2 | 112h | 16h | 8h | 136h |
| Phase 3 | 68h | 24h | 16h | 108h |
| **總計** | **332h** | **60h** | **32h** | **424h** |

**團隊配置**:

- 2 名全職開發 × 12 週 = 384h
- 1 名 QA/DevOps × 12 週 = 96h
- **總可用**: 480h
- **緩衝**: 56h (11.7%)

---

## 🚨 風險與緩解

| 風險 | 機率 | 影響 | 緩解措施 |
|------|:----:|:----:|----------|
| Resources 簡化破壞現有功能 | M | H | 先建立完整測試覆蓋 |
| WebSocket 效能問題 | M | M | Week 4 壓測驗證 |
| 智慧派遣準確率不足 | H | M | Week 6 調整算法權重 |
| 第三方 API (Twilio/SendGrid) 延遲 | L | L | 使用 queue 非同步發送 |
| PostGIS 查詢效能 | M | M | 建立 GiST 索引 |

---

## 📝 每週站會議程 (建議)

### Monday

- 上週交付檢視
- 本週目標確認
- 阻礙識別

### Wednesday

- 進度檢查
- 技術難題討論

### Friday

- 本週總結
- 下週規劃
- Demo (每兩週)

---

## 🎯 成功指標 (KPI)

| 指標 | 目標 | 測量方式 |
|------|:----:|----------|
| E2E 流程完整度 | 100% | 手動測試 Pass Rate |
| API 測試覆蓋率 | > 70% | Jest coverage report |
| 安全 Guard 覆蓋率 | 100% | 靜態掃描 |
| 關鍵 API 回應時間 | < 500ms | APM 監控 |
| WebSocket 延遲 | < 200ms | 壓測報告 |
| 文件完整度 | 100% | Checklist |

---

**交付里程碑總覽**:

- ✅ Week 4: 核心閉環 + ICS 基礎
- ✅ Week 8: 智慧功能 + AAR
- ✅ Week 12: 生產就緒

**下一步**: 產出 Deprecation Cleanup (D) + Security & Governance (E)
